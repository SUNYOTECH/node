/*! stampery-node 2016-04-13 */
(function(){var a,b,c,d,e,f,g,h,i;d=require("iced-runtime"),h=i=function(){},c=require("crypto"),e=require("net"),a=require("msgpackrpc"),f=require("retry"),g=require("stream"),b=function(){function b(b,f){var g,h,j,k,l;l=i,j=d.findDeferral(arguments),this.apiSecret=b,this.beta=f,h=c.createHash("md5"),h.update(this.apiSecret),h=h.digest("hex"),this.clientId=h.substring(0,15),this.sock=e.Socket(),function(a){return function(b){k=new d.Deferrals(b,{parent:j,filename:"./index.iced",funcname:"Stampery"}),a.sock.connect(4e3,"localhost",k.defer({assign_fn:function(){return function(){return g=arguments[0]}}(),lineno:14})),k._fulfill()}}(this)(function(b){return function(){return b.rpc=new a("stampery.3",b.sock),b.authed=!1}}(this))}return b.prototype.hash=function(a){var b;return b=c.createHash("sha256"),b.update(a),b.digest("hex")},b.prototype.hashFile=function(a,b){var d;return d=c.createHash("sha256"),d.setEncoding("hex"),a.on("end",function(){return d.end(),b(d.read())}),a.pipe(d)},b.prototype.stamp=function(a,b){var c,e,f,h,j,k,l;l=i,j=d.findDeferral(arguments),c=null,function(b){return function(e){return a instanceof g?void!function(c){k=new d.Deferrals(c,{parent:j,filename:"./index.iced",funcname:"Stampery.stamp"}),b.hashFile(a,k.defer({assign_fn:function(){return function(){return f=arguments[0]}}(),lineno:36})),k._fulfill()}(function(){return e(c=f)}):e(c=b.hash(a))}}(this)(function(a){return function(){!function(c){return a.authed?c():void!function(b){k=new d.Deferrals(b,{parent:j,filename:"./index.iced",funcname:"Stampery.stamp"}),a.rpc.invoke("auth",[a.clientId,a.apiSecret],k.defer({assign_fn:function(){return function(){return e=arguments[0],h=arguments[1]}}(),lineno:42})),k._fulfill()}(function(){return e?b(e,null):c()})}(function(){return a.rpc.invoke("stamp",[c],b)})}}(this))},b}(),module.exports=b}).call(this);