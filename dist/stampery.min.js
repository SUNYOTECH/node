(function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};b=require("crypto"),c=require("request"),a=function(){function a(a,c){var e;this.clientSecret=a,this.env=c,this._merkleMix=d(this._merkleMix,this),this._checkSiblings=d(this._checkSiblings,this),this.prove=d(this.prove,this),this._req=d(this._req,this),this._post=d(this._post,this),this._get=d(this._get,this),this.stamp=d(this.stamp,this),this.getAll=d(this.getAll,this),this.getByHash=d(this.getByHash,this),this.getById=d(this.getById,this),this.clientId=b.createHash("md5").update(this.clientSecret).digest("hex").substring(0,15),console.log(this.clientId,this.clientSecret),e=new Buffer(this.clientId+":"+this.clientSecret),this.auth="Basic "+e.toString("base64"),this.host="beta"===this.env?"http://api-beta.stampery.com":"https://api.stampery.com"}return a.prototype.hash=function(a){return b.createHash("sha256").update(a).digest()},a.prototype.getById=function(a,b){return this._get("stamps/"+a,function(a,c){return c&&(c=c[0]),b(a,c)})},a.prototype.getByHash=function(a,b){return this._get("stamps/"+a,b)},a.prototype.getAll=function(a,b){var c,d;return d=null!=b?[a,b]:[0,a],c=d[0],a=d[1],this._get("stamps?page="+c,a)},a.prototype.stamp=function(a,b){return a instanceof Buffer&&(a=a.toString("hex")),this._post("stamps",{hash:a},b)},a.prototype._get=function(a,b){return this._req("GET",a,{},b)},a.prototype._post=function(a,b,c){return this._req("POST",a,b,c)},a.prototype._req=function(a,b,d,e){var f;return f={method:a,url:this.host+"/"+b,headers:{Authorization:this.auth,"Content-Type":"application/json"}},d&&(f.json=JSON.stringify(d)),c(f,function(a,b,c){return a?e(a,null):e(c.error,c.result)})},a.prototype.prove=function(a){var b;return"receipts"in a&&(a=a.receipts),console.log("Proving",a),b=a.btc||a.eth,!!b&&this._checkSiblings(b.targetHash,b.proof,b.merkleRoot)},a.prototype._checkSiblings=function(a,b,c){var d,e,f,g;return b.length>0?(e=b[0],g=b.slice(1),d="left"in[e.left,a]?[a,e.left]:void 0,f=this._merkleMix(d),_checkSiblings(f,g,c)):a===c},a.prototype._merkleMix=function(a){var b;return b=Buffer.concat(a.map(function(a){return Buffer(a,"hex")})),this.hash(b)},a}(),module.exports=a}).call(this);